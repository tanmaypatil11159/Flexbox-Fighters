<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning-German</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background-color: #131f24;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .game-container {
        background: rgba(68, 68, 68, 0);
        border-radius: 20px;
        color: rgb(0, 0, 0);
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        width: 90%;
        text-align: center;
        backdrop-filter: blur(10px);
      }

      .game-header {
        margin-bottom: 30px;
      }

      .game-title {
        font-size: 2.5rem;
        color: linear-gradient(
          to left,
          #00f0ff,
          #9604ff,
          #ff00d4,
          #0081f2,
          #00f0ff
        );
        margin-bottom: 10px;
      }

      .hearts-container {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
      }

      .line {
        background-color: #37464f;
        height: 2px;
        width: 100%;
      }

      .heart {
        font-size: 2rem;
        color: #e53e3e;
        transition: all 0.3s ease;
      }

      .heart.lost {
        transform: scale(0);
      }

      .score-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        font-size: 25px;
        font-weight: bold;
        color: white;
      }

      .question-container {
        background: #6c6f7100;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        color: black;
      }

      .question {
        font-size: 30px;
        font-weight: bold;
        margin-bottom: 20px;
        color: #000000;
        line-height: 1.5;
      }

      .options {
        display: grid;
        gap: 15px;
        margin-bottom: 20px;
      }

      .option {
        background: #37464f;
        border: 2px solid #787878;
        border-radius: 12px;
        color: white;
        padding: 15px 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        text-align: left;
        position: relative;
        overflow: hidden;
      }

      .option:hover {
        transform: translateY(2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .option.selected {
        background: linear-gradient(135deg, #4fb0ff 0%, #3182ce 100%);
        color: white;
        border-color: #50a2ff;
      }

      /* for correct */
      .option.correct {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        border-color: #2f855a;
      }

      /* for wrong */
      .option.wrong {
        background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        color: white;
        border-color: #9b2c2c;
      }

      .option.disabled {
        pointer-events: none;
        opacity: 0.7;
      }

      .next-btn {
        background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 15px 30px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: none;
      }

      .next-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(66, 153, 225, 0.4);
      }

      .result-screen {
        display: none;
        text-align: center;
      }

      .result-title {
        font-size: 2.5rem;
        margin-bottom: 20px;
        color: #4a5568;
      }

      .final-score {
        font-size: 1.5rem;
        margin-bottom: 30px;
        color: #a6a1a1;
      }

      .restart-btn {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 15px 30px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .restart-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
      }

      .feedback {
        margin: 15px 0;
        font-weight: bold;
        font-size: 1.1rem;
        padding: 10px;
        border-radius: 8px;
        display: none;
      }

      .feedback.correct {
        background: #c6f6d5;
        color: #22543d;
        border: 1px solid #9ae6b4;
      }

      .feedback.wrong {
        background: #fed7d7;
        color: #742a2a;
        border: 1px solid #feb2b2;
      }

      @keyframes heartBeat {
        0% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.5);
        }

        100% {
          transform: scale(1);
        }
      }

      .heart.beating {
        animation: heartBeat 0.6s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }

        25% {
          transform: translateX(-10px);
        }

        75% {
          transform: translateX(10px);
        }
      }

      .shake {
        animation: shake 0.6s ease-in-out;
      }

      .redo {
        font-size: larger;
        color: white;
        margin-top: 20px;
        padding: 10px;
        background-color: red;
        border-radius: 10px;
        border: none;
      }

      .redo:hover {
        background-color: rgb(137, 0, 0);
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div class="game-container">
      <div class="game-header">
        <!-- part 1 -->
        <div id="lottie-animation"></div>
        <h1 class="game-title" style="color: white">JAPANESE WITH LANGSY</h1>
        <div class="hearts-container" id="heartsContainer">
          <span class="heart"
            ><img
              src="https://d35aaqx5ub95lt.cloudfront.net/images/hearts/7631e3ee734dd4fe7792626b59457fa4.svg"
          /></span>
          <span class="heart"
            ><img
              src="https://d35aaqx5ub95lt.cloudfront.net/images/hearts/7631e3ee734dd4fe7792626b59457fa4.svg"
          /></span>
          <span class="heart"
            ><img
              src="https://d35aaqx5ub95lt.cloudfront.net/images/hearts/7631e3ee734dd4fe7792626b59457fa4.svg"
          /></span>
          <span class="heart"
            ><img
              src="https://d35aaqx5ub95lt.cloudfront.net/images/hearts/7631e3ee734dd4fe7792626b59457fa4.svg"
          /></span>
          <span class="heart"
            ><img
              src="https://d35aaqx5ub95lt.cloudfront.net/images/hearts/7631e3ee734dd4fe7792626b59457fa4.svg"
          /></span>
        </div>

        <div class="score-info">
          <span>Question: <span id="questionNumber">1</span></span>
          <span>Score: <span id="score">0</span></span>
        </div>

        <div class="line"></div>
      </div>
      <!-- part 2 -->
      <div id="gameArea">
        <div style="color: white" class="question" id="question"></div>
        <div class="question-container">
          <div class="options" id="options"></div>
          <div class="feedback" id="feedback"></div>
          <button class="next-btn" id="nextBtn" onclick="nextQuestion()">
            Next Question
          </button>
        </div>
      </div>

      <div class="result-screen" id="resultScreen">
        <h2 class="result-title" id="resultTitle"></h2>
        <div class="final-score" id="finalScore"></div>
        <button class="restart-btn" onclick="restartGame()">Play Again</button>
      </div>
    </div>

    <script>
      const totalMCQuestions = 10;
      let currentQuestion = 0;
      let score = 0;
      let hearts = 5;
      let selectedOption = -1;

      const gameArea = document.getElementById("gameArea");
      const resultScreen = document.getElementById("resultScreen");
      const questionEl = document.getElementById("question");
      const questionNumEl = document.getElementById("questionNumber");
      const optionsContainer = document.getElementById("options");
      const feedbackEl = document.getElementById("feedback");
      const nextBtn = document.getElementById("nextBtn");
      const heartsEls = document.querySelectorAll(
        "#heartsContainer .heart img"
      );
      const scoreEl = document.getElementById("score");

      const correctSound = new Audio("correct.mp3");
      const wrongSound = new Audio("wrong.mp3");
      const winSound = new Audio("win.mp3");
      const gameOverSound = new Audio("gameOver.mp3");

      function startGame() {
        currentQuestion = 0;
        score = 0;
        hearts = 5;
        selectedOption = -1;

        updateHeartsDisplay();
        updateScore();
        showPhase("quiz");
        displayQuestion();
      }

      function displayQuestion() {
        // hide feedback & next button
        feedbackEl.style.display = "none";
        nextBtn.style.display = "none";
        selectedOption = -1;

        questionNumEl.textContent = `${
          currentQuestion + 1
        }/${totalMCQuestions}`;

        fetch("https://kanjiapi.dev/v1/kanji/jlpt-5")
          .then((res) => res.json())
          .then((list) => list.sort(() => Math.random() - 0.5).slice(0, 4))
          .then((choices) =>
            Promise.all(
              choices.map((k) =>
                fetch(`https://kanjiapi.dev/v1/kanji/${k}`).then((r) =>
                  r.json()
                )
              )
            )
          )
          .then((data) => {
            const questionData = data[0];
            const correctMeaning = questionData.meanings[0];
            const opts = data.map((d) => d.meanings[0]);
            const shuffled = opts.sort(() => Math.random() - 0.5);
            const correctIndex = shuffled.indexOf(correctMeaning);

            questionEl.textContent = `What does "${questionData.kanji}" mean?`;

            optionsContainer.innerHTML = "";
            shuffled.forEach((opt, i) => {
              const div = document.createElement("div");
              div.className = "option";
              div.textContent = `${String.fromCharCode(65 + i)}. ${opt}`;
              div.onclick = () => selectOption(i, correctIndex, shuffled);
              optionsContainer.appendChild(div);
            });
          })
          .catch(console.error);
      }

      function selectOption(idx, correctIdx, opts) {
        if (selectedOption !== -1) return;
        selectedOption = idx;

        const allOpts = document.querySelectorAll(".option");
        allOpts.forEach((o) => o.classList.add("disabled"));
        allOpts[correctIdx].classList.add("correct");

        if (idx === correctIdx) {
          score += 10;
          updateScore();
          showFeedback(true);
          correctSound.play().catch(console.error);
        } else {
          allOpts[idx].classList.add("wrong");
          loseHeart();
          showFeedback(false, opts[correctIdx]);
          wrongSound.play().catch(console.error);
        }

        nextBtn.style.display = "inline-block";

        if (hearts === 0) {
          gameOverSound.play().catch(console.error);
          setTimeout(endGame, 1000);
        }
      }

      function showFeedback(isCorrect, correctAns = "") {
        feedbackEl.style.display = "block";
        if (isCorrect) {
          feedbackEl.textContent = "🎉 Correct!";
          feedbackEl.className = "feedback correct";
        } else {
          feedbackEl.textContent = `💔 Wrong! Answer: ${correctAns}`;
          feedbackEl.className = "feedback wrong";
        }
      }

      function loseHeart() {
        if (hearts > 0) hearts--;
        updateHeartsDisplay();
      }

      function updateHeartsDisplay() {
        heartsEls.forEach((img, i) => {
          img.style.opacity = i < hearts ? "1" : "0.2";
        });
      }

      function updateScore() {
        scoreEl.textContent = score;
      }

      function nextQuestion() {
        currentQuestion++;
        if (currentQuestion >= totalMCQuestions) {
          winSound.play().catch(console.error);
          endGame();
        } else {
          displayQuestion();
        }
      }

      function endGame() {
        showPhase("result");
        const titleEl = document.getElementById("resultTitle");
        const finalEl = document.getElementById("finalScore");

        if (hearts === 0) {
          titleEl.textContent = "Game Over!";
          titleEl.style.color = "#e53e3e";
        } else {
          titleEl.textContent = "🎉 All Done!";
          titleEl.style.color = "#48bb78";
        }

        const maxScore = totalMCQuestions * 10;
        const percent = Math.round((score / maxScore) * 100);

        finalEl.innerHTML = `
    <div>Score: <strong>${score}/${maxScore}</strong></div>
    <div>Percentage: <strong>${percent}%</strong></div>
    <div>Hearts Left: <strong>${hearts}/5</strong></div>
  `;
      }

      function restartGame() {
        startGame();
      }

      function showPhase(phase) {
        gameArea.style.display = phase === "quiz" ? "block" : "none";
        resultScreen.style.display = phase === "result" ? "block" : "none";
      }

      window.nextQuestion = nextQuestion;
      window.restartGame = restartGame;

      window.onload = startGame;
    </script>
  </body>
</html>
